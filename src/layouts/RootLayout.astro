---
import { ClientRouter } from "astro:transitions";

const { class: className } = Astro.props;
---

<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width" />
        <meta name="generator" content={Astro.generator} />

        <title>Yiu-Fai Cheung</title>
        
        <link rel="icon" type="image/x-icon" href="/favicon.ico?v=2" />
        <meta name="keywords" content="Large Language Models, LLM, The Chinese University of Hong Kong, CUHK, Computer Science, CS, Artificial Intelligence, AI, Yiu-Fai Cheung, Frankie Cheung, Cheung Yiu Fai, Hong Kong, HK">
        <meta name="description" content="I am a final-year student majoring in Computer Science at The Chinese University of Hong Kong, my research interest includes AI for Mental Health, AI for Social Good, the reliability and safety of Large Language Models, multi-agent systems and other applications.">
        <meta name="author" content="Yiu-Fai Cheung">
        
        <ClientRouter />
    </head>
    <body
        class:list={[
            "bg-shironeri text-kuro font-sans xs:text-[16px] md:text-[18px] dark:bg-sumi dark:text-shironeri transition-all relative min-h-screen",
            className,
        ]}
    >
        <slot />

        <script>
            function colorTheme() {
                if (
                    localStorage.theme == "dark" ||
                    (!("theme" in localStorage) &&
                        window.matchMedia("(prefers-color-scheme: dark)")
                            .matches)
                ) {
                    document.documentElement.classList.add("dark");
                } else {
                    document.documentElement.classList.remove("dark");
                }
            }

            let scrollAnimObserver: IntersectionObserver | null = null;
            
            function setupScrollAnimations() {
                if (scrollAnimObserver) scrollAnimObserver.disconnect();

                const targets = document.querySelectorAll("[data-animate]");
                if (!targets.length) return;

                scrollAnimObserver = new IntersectionObserver(
                    (entries) => {
                        entries.forEach((entry) => {
                            const el: Element = entry.target;
                            if (entry.isIntersecting) {
                                el.classList.remove("animate-in");
                                el.classList.add("animate-in");
                            } else {
                                el.classList.remove("animate-in");
                            }
                        });
                    },
                    { threshold: 0.4 }
                );

                if (scrollAnimObserver) {
                    targets.forEach((el) => scrollAnimObserver && scrollAnimObserver.observe(el));
                }
            }

            colorTheme();
            setupScrollAnimations();

            document.addEventListener("astro:after-swap", () => {
                colorTheme();
                setupScrollAnimations();
            });
        </script>
    </body>
</html>

<style is:global>
    img {
        content-visibility: auto;
    }
</style>
