---
import { Image } from "astro:assets";
import { getCollection, render } from "astro:content";
import HeadingWithUnderline from "@components/HeadingWithUnderline";
import mdComponent from "@components/md/components";
import { MapPin } from "lucide-react";

const experience = await getCollection("experience");

// sort by id for latest event to be on top
experience.sort(function (a, b) {
    return -(Number(a.id) - Number(b.id));
});
---

<section class="mb-24">
    <HeadingWithUnderline client:load text="Work Experiences" />

    <div class="grid gap-8">
        {
            experience.map(async (event, index) => {
                const { Content } = await render(event);

                return (
                    <div class="flex gap-6 items-center">
                        <div class="hidden md:flex w-36 h-36 bg-shironeri rounded-full items-center justify-center shrink-0 mt-1">
                            <Image
                                src={event.data.image}
                                alt={event.data.title}
                                width="128"
                                height="128"
                                class="hidden md:block object-contain"
                            />
                        </div>

                        <div class="flex-1 min-w-0">
                            <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4 mb-4">
                                <div>
                                    <h3 class="text-xl font-bold">
                                        {event.data.title}
                                    </h3>
                                    <p class="text-gray-500 dark:text-gray-400 mt-1 flex items-center gap-2">
                                        <MapPin className="h-4 w-4 shrink-0" />
                                        {event.data.location}
                                    </p>
                                </div>
                                
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold bg-mizugaki/10 text-mizugaki border border-mizugaki/20 shadow-sm whitespace-nowrap tracking-wider self-start">
                                    {event.data.duration}
                                </span>
                            </div>

                            <div class="md">
                                <Content components={mdComponent} />
                            </div>
                        </div>
                    </div>
                );
            })
        }
    </div>
</section>

